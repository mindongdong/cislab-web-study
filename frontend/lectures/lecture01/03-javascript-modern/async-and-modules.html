<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JavaScript ë¹„ë™ê¸°ì™€ ëª¨ë“ˆ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        
        h1 {
            text-align: center;
            color: #333;
        }
        
        h2 {
            color: #2196F3;
            border-bottom: 2px solid #2196F3;
            padding-bottom: 5px;
        }
        
        .code-example {
            background-color: #f4f4f4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            border-left: 4px solid #2196F3;
            margin: 15px 0;
            overflow-x: auto;
        }
        
        .output {
            background-color: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
            margin: 10px 0;
        }
        
        .error {
            background-color: #ffebee;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #f44336;
            margin: 10px 0;
        }
        
        .warning {
            background-color: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
            margin: 10px 0;
        }
        
        .interactive-demo {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        
        button {
            background-color: #2196F3;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        
        button:hover {
            background-color: #1976D2;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        input, select {
            padding: 5px;
            margin: 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .promise-chain {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background-color: #f0f0f0;
            border-radius: 5px;
        }
        
        .promise-step {
            padding: 5px 10px;
            background-color: #e3f2fd;
            border-radius: 3px;
            border: 1px solid #2196F3;
        }
        
        .arrow {
            font-size: 18px;
            color: #2196F3;
        }
    </style>
</head>
<body>
    <h1>JavaScript ë¹„ë™ê¸° ì²˜ë¦¬ì™€ ëª¨ë“ˆ ì‹œìŠ¤í…œ</h1>
    
    <!-- 1. Promise ê¸°ì´ˆ -->
    <section class="section">
        <h2>1. Promise ê¸°ì´ˆ</h2>
        
        <div class="code-example">
// Promise ê¸°ë³¸ êµ¬ì¡°
const myPromise = new Promise((resolve, reject) => {
    // ë¹„ë™ê¸° ì‘ì—… ì‹œë®¬ë ˆì´ì…˜
    const success = Math.random() > 0.5;
    
    setTimeout(() => {
        if (success) {
            resolve("ì‘ì—… ì„±ê³µ!");
        } else {
            reject(new Error("ì‘ì—… ì‹¤íŒ¨!"));
        }
    }, 1000);
});

// Promise ì‚¬ìš©
myPromise
    .then(result => {
        console.log("ì„±ê³µ:", result);
        return "ë‹¤ìŒ ë‹¨ê³„ë¡œ ì „ë‹¬í•  ë°ì´í„°";
    })
    .then(data => {
        console.log("ì²´ì´ë‹:", data);
    })
    .catch(error => {
        console.error("ì—ëŸ¬:", error.message);
    })
    .finally(() => {
        console.log("ì‘ì—… ì™„ë£Œ (ì„±ê³µ/ì‹¤íŒ¨ ë¬´ê´€)");
    });

// Promise ìƒíƒœ
// - Pending: ëŒ€ê¸° (ì´ˆê¸° ìƒíƒœ)
// - Fulfilled: ì´í–‰ (ì„±ê³µ)
// - Rejected: ê±°ë¶€ (ì‹¤íŒ¨)

// ì¦‰ì‹œ resolveë˜ëŠ” Promise
const immediatePromise = Promise.resolve("ì¦‰ì‹œ ì„±ê³µ");
const errorPromise = Promise.reject(new Error("ì¦‰ì‹œ ì‹¤íŒ¨"));

// ì—¬ëŸ¬ Promise ë™ì‹œ ì²˜ë¦¬
const promise1 = Promise.resolve(3);
const promise2 = new Promise(resolve => setTimeout(() => resolve('foo'), 1000));
const promise3 = Promise.resolve(42);

Promise.all([promise1, promise2, promise3])
    .then(values => {
        console.log(values); // [3, "foo", 42]
    });

// ê°€ì¥ ë¨¼ì € ì™„ë£Œë˜ëŠ” Promise
Promise.race([promise1, promise2, promise3])
    .then(value => {
        console.log(value); // 3 (ê°€ì¥ ë¹¨ë¦¬ ì™„ë£Œ)
    });
        </div>
        
        <div class="interactive-demo">
            <h3>ğŸ”§ Promise ì‹¤ìŠµ</h3>
            <button onclick="demonstratePromise()">Promise í…ŒìŠ¤íŠ¸</button>
            <button onclick="demonstratePromiseAll()">Promise.all í…ŒìŠ¤íŠ¸</button>
            <button onclick="demonstratePromiseRace()">Promise.race í…ŒìŠ¤íŠ¸</button>
            <div id="promise-output"></div>
        </div>
        
        <div class="warning">
            <strong>Promise ì²´ì´ë‹ ì£¼ì˜ì‚¬í•­:</strong>
            <ul>
                <li><code>.then()</code>ì—ì„œ ê°’ì„ ë°˜í™˜í•˜ë©´ ë‹¤ìŒ <code>.then()</code>ìœ¼ë¡œ ì „ë‹¬ë©ë‹ˆë‹¤.</li>
                <li>Promiseë¥¼ ë°˜í™˜í•˜ë©´ í•´ë‹¹ Promiseê°€ ì™„ë£Œë  ë•Œê¹Œì§€ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</li>
                <li><code>.catch()</code>ëŠ” ì²´ì¸ì˜ ì–´ëŠ ì§€ì ì—ì„œë“  ë°œìƒí•œ ì—ëŸ¬ë¥¼ ì²˜ë¦¬í•©ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </section>
    
    <!-- 2. async/await -->
    <section class="section">
        <h2>2. async/await</h2>
        
        <div class="code-example">
// async/await ê¸°ë³¸ ì‚¬ìš©ë²•
async function fetchUserData(userId) {
    try {
        // fetchëŠ” Promiseë¥¼ ë°˜í™˜
        const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const userData = await response.json();
        return userData;
    } catch (error) {
        console.error("ì‚¬ìš©ì ë°ì´í„° ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
        throw error; // ì—ëŸ¬ë¥¼ ë‹¤ì‹œ ë˜ì ¸ì„œ í˜¸ì¶œìê°€ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ í•¨
    }
}

// async í•¨ìˆ˜ ì‚¬ìš©
async function displayUserInfo() {
    try {
        const user = await fetchUserData(1);
        console.log(`ì‚¬ìš©ì ì´ë¦„: ${user.name}`);
        console.log(`ì´ë©”ì¼: ${user.email}`);
    } catch (error) {
        console.error("ì‚¬ìš©ì ì •ë³´ í‘œì‹œ ì‹¤íŒ¨:", error);
    }
}

// ì—¬ëŸ¬ async ì‘ì—… ë™ì‹œ ì‹¤í–‰
async function fetchMultipleUsers() {
    try {
        // ìˆœì°¨ ì‹¤í–‰ (ëŠë¦¼)
        const user1 = await fetchUserData(1);
        const user2 = await fetchUserData(2);
        
        // ë³‘ë ¬ ì‹¤í–‰ (ë¹ ë¦„)
        const [user3, user4] = await Promise.all([
            fetchUserData(3),
            fetchUserData(4)
        ]);
        
        return [user1, user2, user3, user4];
    } catch (error) {
        console.error("ë‹¤ì¤‘ ì‚¬ìš©ì ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨:", error);
    }
}

// async IIFE (ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜)
(async () => {
    const users = await fetchMultipleUsers();
    console.log("ëª¨ë“  ì‚¬ìš©ì:", users);
})();

// ë°°ì—´ì˜ ê° ìš”ì†Œì— ëŒ€í•´ ë¹„ë™ê¸° ì‘ì—…
async function processUsers(userIds) {
    // ìˆœì°¨ ì²˜ë¦¬
    const results1 = [];
    for (const id of userIds) {
        const user = await fetchUserData(id);
        results1.push(user);
    }
    
    // ë³‘ë ¬ ì²˜ë¦¬
    const results2 = await Promise.all(
        userIds.map(id => fetchUserData(id))
    );
    
    return { sequential: results1, parallel: results2 };
}

// async í•¨ìˆ˜ëŠ” í•­ìƒ Promiseë¥¼ ë°˜í™˜
async function simpleAsync() {
    return "Hello"; // Promise.resolve("Hello")ì™€ ë™ì¼
}

simpleAsync().then(result => console.log(result)); // "Hello"
        </div>
        
        <div class="interactive-demo">
            <h3>ğŸ”§ async/await ì‹¤ìŠµ</h3>
            <input type="number" id="userId" placeholder="ì‚¬ìš©ì ID (1-10)" value="1" min="1" max="10">
            <button onclick="demonstrateAsyncAwait()">ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°</button>
            <button onclick="demonstrateParallelAsync()">ì—¬ëŸ¬ ì‚¬ìš©ì ë³‘ë ¬ ì²˜ë¦¬</button>
            <div id="async-output"></div>
        </div>
        
        <div class="promise-chain">
            <div class="promise-step">í•¨ìˆ˜ í˜¸ì¶œ</div>
            <div class="arrow">â†’</div>
            <div class="promise-step">await</div>
            <div class="arrow">â†’</div>
            <div class="promise-step">ë¹„ë™ê¸° ì‘ì—…</div>
            <div class="arrow">â†’</div>
            <div class="promise-step">ê²°ê³¼ ë°˜í™˜</div>
        </div>
    </section>
    
    <!-- 3. ì—ëŸ¬ ì²˜ë¦¬ -->
    <section class="section">
        <h2>3. ë¹„ë™ê¸° ì—ëŸ¬ ì²˜ë¦¬</h2>
        
        <div class="code-example">
// Promise ì—ëŸ¬ ì²˜ë¦¬
function fetchDataPromise() {
    return fetch('/api/data')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            return response.json();
        })
        .catch(error => {
            if (error.name === 'TypeError') {
                console.error('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬:', error.message);
            } else {
                console.error('API ì—ëŸ¬:', error.message);
            }
            throw error; // ì¬throwí•˜ì—¬ í˜¸ì¶œìê°€ ì²˜ë¦¬í•˜ê²Œ í•¨
        });
}

// async/await ì—ëŸ¬ ì²˜ë¦¬
async function fetchDataAsync() {
    try {
        const response = await fetch('/api/data');
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const data = await response.json();
        return data;
    } catch (error) {
        if (error.name === 'TypeError') {
            console.error('ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬:', error.message);
        } else if (error.message.includes('HTTP')) {
            console.error('HTTP ì—ëŸ¬:', error.message);
        } else {
            console.error('ê¸°íƒ€ ì—ëŸ¬:', error.message);
        }
        
        // ê¸°ë³¸ê°’ ë°˜í™˜ ë˜ëŠ” ì¬throw
        return null; // ë˜ëŠ” throw error;
    }
}

// ë³µì¡í•œ ì—ëŸ¬ ì²˜ë¦¬ ì‹œë‚˜ë¦¬ì˜¤
async function robustDataFetch(url, retries = 3) {
    for (let attempt = 1; attempt <= retries; attempt++) {
        try {
            const response = await fetch(url);
            
            if (response.ok) {
                return await response.json();
            }
            
            if (response.status >= 500 && attempt < retries) {
                console.log(`ì„œë²„ ì—ëŸ¬ (${response.status}), ì¬ì‹œë„ ${attempt}/${retries}`);
                await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
                continue;
            }
            
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            
        } catch (error) {
            if (attempt === retries) {
                throw new Error(`${retries}ë²ˆ ì‹œë„ í›„ ì‹¤íŒ¨: ${error.message}`);
            }
            
            console.log(`ì‹œë„ ${attempt} ì‹¤íŒ¨:`, error.message);
            await new Promise(resolve => setTimeout(resolve, 1000 * attempt));
        }
    }
}

// íƒ€ì„ì•„ì›ƒê³¼ í•¨ê»˜ ì‚¬ìš©
function withTimeout(promise, timeoutMs) {
    const timeout = new Promise((_, reject) =>
        setTimeout(() => reject(new Error('ì‘ì—… ì‹œê°„ ì´ˆê³¼')), timeoutMs)
    );
    
    return Promise.race([promise, timeout]);
}

async function fetchWithTimeout(url) {
    try {
        const response = await withTimeout(fetch(url), 5000); // 5ì´ˆ íƒ€ì„ì•„ì›ƒ
        return await response.json();
    } catch (error) {
        if (error.message === 'ì‘ì—… ì‹œê°„ ì´ˆê³¼') {
            console.error('ìš”ì²­ ì‹œê°„ ì´ˆê³¼');
        } else {
            console.error('ê¸°íƒ€ ì—ëŸ¬:', error.message);
        }
        throw error;
    }
}
        </div>
        
        <div class="interactive-demo">
            <h3>ğŸ”§ ì—ëŸ¬ ì²˜ë¦¬ ì‹¤ìŠµ</h3>
            <button onclick="demonstrateErrorHandling()">ì •ìƒ ìš”ì²­</button>
            <button onclick="demonstrateErrorHandling(true)">ì—ëŸ¬ ë°œìƒ</button>
            <button onclick="demonstrateRetry()">ì¬ì‹œë„ ë¡œì§</button>
            <div id="error-output"></div>
        </div>
    </section>
    
    <!-- 4. ES Modules -->
    <section class="section">
        <h2>4. ES Modules (Import/Export)</h2>
        
        <div class="code-example">
// utils.js - ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
// Named Exports (ì´ë¦„ìˆëŠ” ë‚´ë³´ë‚´ê¸°)
export function add(a, b) {
    return a + b;
}

export function multiply(a, b) {
    return a * b;
}

export const PI = 3.14159;

export class Calculator {
    constructor() {
        this.result = 0;
    }
    
    add(value) {
        this.result += value;
        return this;
    }
    
    multiply(value) {
        this.result *= value;
        return this;
    }
    
    getResult() {
        return this.result;
    }
}

// í•œë²ˆì— ì—¬ëŸ¬ ê°œ ë‚´ë³´ë‚´ê¸°
const subtract = (a, b) => a - b;
const divide = (a, b) => a / b;

export { subtract, divide };

// ---

// math.js - ìˆ˜í•™ ê´€ë ¨ í•¨ìˆ˜ë“¤
// Default Export (ê¸°ë³¸ ë‚´ë³´ë‚´ê¸°)
export default function fibonacci(n) {
    if (n <= 1) return n;
    return fibonacci(n - 1) + fibonacci(n - 2);
}

// Named exportì™€ í•¨ê»˜ ì‚¬ìš© ê°€ëŠ¥
export function factorial(n) {
    return n <= 1 ? 1 : n * factorial(n - 1);
}

// ---

// main.js - ë©”ì¸ íŒŒì¼
// Named Imports
import { add, multiply, PI, Calculator } from './utils.js';

// Default Import
import fibonacci from './math.js';

// í˜¼í•© Import
import fib, { factorial } from './math.js';

// ëª¨ë“  named exportsë¥¼ í•˜ë‚˜ì˜ ê°ì²´ë¡œ import
import * as utils from './utils.js';

// ë³„ì¹­ ì‚¬ìš©
import { add as plus, multiply as times } from './utils.js';

// ì‚¬ìš© ì˜ˆì‹œ
console.log(add(5, 3)); // 8
console.log(plus(5, 3)); // 8 (ë³„ì¹­ ì‚¬ìš©)
console.log(utils.PI); // 3.14159

const calc = new Calculator();
const result = calc.add(10).multiply(2).getResult(); // 20

console.log(fibonacci(10)); // 55
console.log(factorial(5)); // 120

// ---

// api.js - API ê´€ë ¨ ëª¨ë“ˆ
const API_BASE_URL = 'https://jsonplaceholder.typicode.com';

async function request(endpoint, options = {}) {
    const url = `${API_BASE_URL}${endpoint}`;
    const config = {
        headers: {
            'Content-Type': 'application/json',
        },
        ...options,
    };
    
    const response = await fetch(url, config);
    
    if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
    }
    
    return response.json();
}

export const api = {
    getUsers: () => request('/users'),
    getUser: (id) => request(`/users/${id}`),
    getPosts: () => request('/posts'),
    createPost: (data) => request('/posts', {
        method: 'POST',
        body: JSON.stringify(data),
    }),
};

// ê¸°ë³¸ exportë„ í•¨ê»˜
export default api;

// ---

// Dynamic Imports (ë™ì  import)
async function loadModule() {
    if (condition) {
        const module = await import('./heavy-module.js');
        module.doSomething();
    }
}

// ì¡°ê±´ë¶€ ëª¨ë“ˆ ë¡œë”©
button.addEventListener('click', async () => {
    const { Chart } = await import('./chart-library.js');
    new Chart(canvas, data);
});
        </div>
        
        <div class="interactive-demo">
            <h3>ğŸ”§ ëª¨ë“ˆ ì‹œìŠ¤í…œ ì‹œë®¬ë ˆì´ì…˜</h3>
            <p>ì‹¤ì œ ëª¨ë“ˆ ì‹œìŠ¤í…œì€ ì„œë²„ í™˜ê²½ì—ì„œ ë™ì‘í•©ë‹ˆë‹¤. ì—¬ê¸°ì„œëŠ” ì‹œë®¬ë ˆì´ì…˜ì„ ë³´ì—¬ë“œë¦½ë‹ˆë‹¤.</p>
            <button onclick="demonstrateModules()">ëª¨ë“ˆ ì‹œë®¬ë ˆì´ì…˜</button>
            <div id="module-output"></div>
        </div>
        
        <div class="warning">
            <strong>ëª¨ë“ˆ ì‚¬ìš© ì‹œ ì£¼ì˜ì‚¬í•­:</strong>
            <ul>
                <li>HTMLì—ì„œ <code>&lt;script type="module"&gt;</code>ë¡œ ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.</li>
                <li>CORS ì •ì±…ìœ¼ë¡œ ì¸í•´ ë¡œì»¬ íŒŒì¼ì€ ì„œë²„ë¥¼ í†µí•´ ì œê³µë˜ì–´ì•¼ í•©ë‹ˆë‹¤.</li>
                <li>ëª¨ë“ˆì€ í•­ìƒ strict modeì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.</li>
                <li>ëª¨ë“ˆì˜ ìµœìƒìœ„ <code>this</code>ëŠ” <code>undefined</code>ì…ë‹ˆë‹¤.</li>
            </ul>
        </div>
    </section>
    
    <!-- 5. ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ -->
    <section class="section">
        <h2>5. ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ</h2>
        
        <div class="code-example">
// ì‹¤ì œ í”„ë¡œì íŠ¸ì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” íŒ¨í„´ë“¤

// 1. API í´ë¼ì´ì–¸íŠ¸ í´ë˜ìŠ¤
class ApiClient {
    constructor(baseURL) {
        this.baseURL = baseURL;
        this.defaults = {
            headers: {
                'Content-Type': 'application/json',
            },
        };
    }
    
    async request(endpoint, options = {}) {
        const url = `${this.baseURL}${endpoint}`;
        const config = { ...this.defaults, ...options };
        
        try {
            const response = await fetch(url, config);
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            return await response.json();
        } catch (error) {
            console.error('API ìš”ì²­ ì‹¤íŒ¨:', error);
            throw error;
        }
    }
    
    get(endpoint) {
        return this.request(endpoint);
    }
    
    post(endpoint, data) {
        return this.request(endpoint, {
            method: 'POST',
            body: JSON.stringify(data),
        });
    }
    
    put(endpoint, data) {
        return this.request(endpoint, {
            method: 'PUT',
            body: JSON.stringify(data),
        });
    }
    
    delete(endpoint) {
        return this.request(endpoint, {
            method: 'DELETE',
        });
    }
}

// 2. ë°ì´í„° í˜ì¹­ í›… íŒ¨í„´
async function useAsync(asyncFunction, dependencies = []) {
    const [state, setState] = useState({
        data: null,
        loading: true,
        error: null,
    });
    
    useEffect(() => {
        let cancelled = false;
        
        async function execute() {
            try {
                setState(prev => ({ ...prev, loading: true, error: null }));
                const data = await asyncFunction();
                
                if (!cancelled) {
                    setState({ data, loading: false, error: null });
                }
            } catch (error) {
                if (!cancelled) {
                    setState({ data: null, loading: false, error });
                }
            }
        }
        
        execute();
        
        return () => {
            cancelled = true;
        };
    }, dependencies);
    
    return state;
}

// 3. ë°°ì¹˜ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹°
async function processBatch(items, batchSize = 3, delay = 1000) {
    const results = [];
    
    for (let i = 0; i < items.length; i += batchSize) {
        const batch = items.slice(i, i + batchSize);
        
        console.log(`ë°°ì¹˜ ${Math.floor(i / batchSize) + 1} ì²˜ë¦¬ ì¤‘...`);
        
        const batchResults = await Promise.all(
            batch.map(async (item) => {
                // ì‹¤ì œ ë¹„ë™ê¸° ì‘ì—…
                await new Promise(resolve => setTimeout(resolve, 500));
                return `ì²˜ë¦¬ë¨: ${item}`;
            })
        );
        
        results.push(...batchResults);
        
        // ë§ˆì§€ë§‰ ë°°ì¹˜ê°€ ì•„ë‹ˆë©´ ì§€ì—°
        if (i + batchSize < items.length) {
            await new Promise(resolve => setTimeout(resolve, delay));
        }
    }
    
    return results;
}

// 4. ìºì‹œê°€ ìˆëŠ” fetch í•¨ìˆ˜
const cache = new Map();

async function cachedFetch(url, cacheTime = 5 * 60 * 1000) { // 5ë¶„ ìºì‹œ
    const now = Date.now();
    const cached = cache.get(url);
    
    if (cached && (now - cached.timestamp) < cacheTime) {
        console.log('ìºì‹œì—ì„œ ë°˜í™˜:', url);
        return cached.data;
    }
    
    console.log('ìƒˆë¡œ fetch:', url);
    const response = await fetch(url);
    const data = await response.json();
    
    cache.set(url, {
        data,
        timestamp: now,
    });
    
    return data;
}

// 5. ì¬ì‹œë„ ë¡œì§ì´ ìˆëŠ” í•¨ìˆ˜
async function withRetry(fn, maxRetries = 3, backoff = 1000) {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
        try {
            return await fn();
        } catch (error) {
            if (attempt === maxRetries) {
                throw new Error(`${maxRetries}ë²ˆ ì‹œë„ í›„ ì‹¤íŒ¨: ${error.message}`);
            }
            
            console.log(`ì‹œë„ ${attempt} ì‹¤íŒ¨, ${backoff * attempt}ms í›„ ì¬ì‹œë„...`);
            await new Promise(resolve => setTimeout(resolve, backoff * attempt));
        }
    }
}
        </div>
        
        <div class="interactive-demo">
            <h3>ğŸ”§ ì‹¤ì œ íŒ¨í„´ í…ŒìŠ¤íŠ¸</h3>
            <button onclick="demonstrateApiClient()">API í´ë¼ì´ì–¸íŠ¸</button>
            <button onclick="demonstrateBatchProcessing()">ë°°ì¹˜ ì²˜ë¦¬</button>
            <button onclick="demonstrateCachedFetch()">ìºì‹œëœ Fetch</button>
            <div id="pattern-output"></div>
        </div>
    </section>
    
    <script>
        // Promise ì‹œì—°
        function demonstratePromise() {
            const output = document.getElementById('promise-output');
            output.innerHTML = '<div class="loading"></div> Promise í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            const testPromise = new Promise((resolve, reject) => {
                const success = Math.random() > 0.3; // 70% ì„±ê³µ í™•ë¥ 
                setTimeout(() => {
                    if (success) {
                        resolve({ message: "ì„±ê³µ!", data: Math.floor(Math.random() * 100) });
                    } else {
                        reject(new Error("ëœë¤ ì‹¤íŒ¨ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."));
                    }
                }, 1000);
            });
            
            testPromise
                .then(result => {
                    output.innerHTML = `
                        <div class="output">
                            <h4>Promise ì„±ê³µ!</h4>
                            <p>ë©”ì‹œì§€: ${result.message}</p>
                            <p>ë°ì´í„°: ${result.data}</p>
                            <p>ì‹œê°„: ${new Date().toLocaleTimeString()}</p>
                        </div>
                    `;
                })
                .catch(error => {
                    output.innerHTML = `
                        <div class="error">
                            <h4>Promise ì‹¤íŒ¨!</h4>
                            <p>ì—ëŸ¬: ${error.message}</p>
                            <p>ì‹œê°„: ${new Date().toLocaleTimeString()}</p>
                        </div>
                    `;
                });
        }
        
        function demonstratePromiseAll() {
            const output = document.getElementById('promise-output');
            output.innerHTML = '<div class="loading"></div> Promise.all í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            const promises = [
                new Promise(resolve => setTimeout(() => resolve('ì²« ë²ˆì§¸ ì™„ë£Œ'), 1000)),
                new Promise(resolve => setTimeout(() => resolve('ë‘ ë²ˆì§¸ ì™„ë£Œ'), 1500)),
                new Promise(resolve => setTimeout(() => resolve('ì„¸ ë²ˆì§¸ ì™„ë£Œ'), 800))
            ];
            
            Promise.all(promises)
                .then(results => {
                    output.innerHTML = `
                        <div class="output">
                            <h4>Promise.all ì„±ê³µ!</h4>
                            <p>ëª¨ë“  ê²°ê³¼: ${results.join(', ')}</p>
                            <p>ì™„ë£Œ ì‹œê°„: ${new Date().toLocaleTimeString()}</p>
                        </div>
                    `;
                });
        }
        
        function demonstratePromiseRace() {
            const output = document.getElementById('promise-output');
            output.innerHTML = '<div class="loading"></div> Promise.race í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            const promises = [
                new Promise(resolve => setTimeout(() => resolve('ëŠë¦° ì‘ì—… (2ì´ˆ)'), 2000)),
                new Promise(resolve => setTimeout(() => resolve('ë¹ ë¥¸ ì‘ì—… (500ms)'), 500)),
                new Promise(resolve => setTimeout(() => resolve('ì¤‘ê°„ ì‘ì—… (1ì´ˆ)'), 1000))
            ];
            
            Promise.race(promises)
                .then(result => {
                    output.innerHTML = `
                        <div class="output">
                            <h4>Promise.race ê²°ê³¼!</h4>
                            <p>ê°€ì¥ ë¹ ë¥¸ ê²°ê³¼: ${result}</p>
                            <p>ì™„ë£Œ ì‹œê°„: ${new Date().toLocaleTimeString()}</p>
                        </div>
                    `;
                });
        }
        
        // async/await ì‹œì—°
        async function demonstrateAsyncAwait() {
            const userId = document.getElementById('userId').value;
            const output = document.getElementById('async-output');
            
            output.innerHTML = '<div class="loading"></div> ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
            
            try {
                // ì‹¤ì œ API í˜¸ì¶œ ì‹œë®¬ë ˆì´ì…˜
                const response = await fetch(`https://jsonplaceholder.typicode.com/users/${userId}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                }
                
                const user = await response.json();
                
                output.innerHTML = `
                    <div class="output">
                        <h4>ì‚¬ìš©ì ì •ë³´</h4>
                        <p><strong>ì´ë¦„:</strong> ${user.name}</p>
                        <p><strong>ì´ë©”ì¼:</strong> ${user.email}</p>
                        <p><strong>ì „í™”ë²ˆí˜¸:</strong> ${user.phone}</p>
                        <p><strong>ì›¹ì‚¬ì´íŠ¸:</strong> ${user.website}</p>
                        <p><strong>íšŒì‚¬:</strong> ${user.company.name}</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="error">
                        <h4>ì—ëŸ¬ ë°œìƒ!</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function demonstrateParallelAsync() {
            const output = document.getElementById('async-output');
            output.innerHTML = '<div class="loading"></div> ì—¬ëŸ¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘...';
            
            const startTime = Date.now();
            
            try {
                // ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì—¬ëŸ¬ ì‚¬ìš©ì ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const userPromises = [1, 2, 3].map(id => 
                    fetch(`https://jsonplaceholder.typicode.com/users/${id}`)
                        .then(response => response.json())
                );
                
                const users = await Promise.all(userPromises);
                const endTime = Date.now();
                
                output.innerHTML = `
                    <div class="output">
                        <h4>ì—¬ëŸ¬ ì‚¬ìš©ì ì •ë³´ (ë³‘ë ¬ ì²˜ë¦¬)</h4>
                        ${users.map(user => `
                            <p><strong>${user.name}</strong> - ${user.email}</p>
                        `).join('')}
                        <p><strong>ì²˜ë¦¬ ì‹œê°„:</strong> ${endTime - startTime}ms</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="error">
                        <h4>ì—ëŸ¬ ë°œìƒ!</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // ì—ëŸ¬ ì²˜ë¦¬ ì‹œì—°
        async function demonstrateErrorHandling(forceError = false) {
            const output = document.getElementById('error-output');
            output.innerHTML = '<div class="loading"></div> ìš”ì²­ ì²˜ë¦¬ ì¤‘...';
            
            try {
                if (forceError) {
                    // ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìë¡œ ì—ëŸ¬ ë°œìƒ
                    const response = await fetch('https://jsonplaceholder.typicode.com/users/999');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
                    }
                } else {
                    // ì •ìƒ ìš”ì²­
                    const response = await fetch('https://jsonplaceholder.typicode.com/users/1');
                    const user = await response.json();
                    
                    output.innerHTML = `
                        <div class="output">
                            <h4>ì •ìƒ ì²˜ë¦¬ ì™„ë£Œ</h4>
                            <p>ì‚¬ìš©ì: ${user.name}</p>
                            <p>ì´ë©”ì¼: ${user.email}</p>
                        </div>
                    `;
                    return;
                }
            } catch (error) {
                if (error.name === 'TypeError') {
                    output.innerHTML = `
                        <div class="error">
                            <h4>ë„¤íŠ¸ì›Œí¬ ì—ëŸ¬</h4>
                            <p>ì¸í„°ë„· ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                            <p>ìƒì„¸: ${error.message}</p>
                        </div>
                    `;
                } else {
                    output.innerHTML = `
                        <div class="error">
                            <h4>API ì—ëŸ¬</h4>
                            <p>${error.message}</p>
                            <p>ì‹œê°„: ${new Date().toLocaleTimeString()}</p>
                        </div>
                    `;
                }
            }
        }
        
        async function demonstrateRetry() {
            const output = document.getElementById('error-output');
            output.innerHTML = '<div class="loading"></div> ì¬ì‹œë„ ë¡œì§ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            let attempts = 0;
            const maxRetries = 3;
            
            async function flakyFunction() {
                attempts++;
                const success = Math.random() > 0.6; // 40% ì„±ê³µ í™•ë¥ 
                
                if (!success) {
                    throw new Error(`ì‹œë„ ${attempts} ì‹¤íŒ¨`);
                }
                
                return `${attempts}ë²ˆì§¸ ì‹œë„ì—ì„œ ì„±ê³µ!`;
            }
            
            try {
                let result;
                for (let attempt = 1; attempt <= maxRetries; attempt++) {
                    try {
                        result = await flakyFunction();
                        break;
                    } catch (error) {
                        if (attempt === maxRetries) {
                            throw new Error(`${maxRetries}ë²ˆ ì‹œë„ í›„ ìµœì¢… ì‹¤íŒ¨`);
                        }
                        
                        output.innerHTML += `<p>ì‹œë„ ${attempt} ì‹¤íŒ¨, ì¬ì‹œë„ ì¤‘...</p>`;
                        await new Promise(resolve => setTimeout(resolve, 1000));
                    }
                }
                
                output.innerHTML = `
                    <div class="output">
                        <h4>ì¬ì‹œë„ ì„±ê³µ!</h4>
                        <p>${result}</p>
                        <p>ì´ ì‹œë„ íšŸìˆ˜: ${attempts}</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="error">
                        <h4>ì¬ì‹œë„ ì‹¤íŒ¨</h4>
                        <p>${error.message}</p>
                        <p>ì´ ì‹œë„ íšŸìˆ˜: ${attempts}</p>
                    </div>
                `;
            }
        }
        
        // ëª¨ë“ˆ ì‹œë®¬ë ˆì´ì…˜
        function demonstrateModules() {
            const output = document.getElementById('module-output');
            
            // ëª¨ë“ˆ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ë³„ë„ íŒŒì¼ì— ìˆì–´ì•¼ í•¨)
            const mathUtils = {
                add: (a, b) => a + b,
                multiply: (a, b) => a * b,
                PI: 3.14159,
                
                Calculator: class {
                    constructor() {
                        this.result = 0;
                    }
                    
                    add(value) {
                        this.result += value;
                        return this;
                    }
                    
                    multiply(value) {
                        this.result *= value;
                        return this;
                    }
                    
                    getResult() {
                        return this.result;
                    }
                }
            };
            
            const apiUtils = {
                async getUser(id) {
                    const response = await fetch(`https://jsonplaceholder.typicode.com/users/${id}`);
                    return response.json();
                },
                
                async createPost(data) {
                    const response = await fetch('https://jsonplaceholder.typicode.com/posts', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    return response.json();
                }
            };
            
            // ëª¨ë“ˆ ì‚¬ìš© ì‹œë®¬ë ˆì´ì…˜
            const calc = new mathUtils.Calculator();
            const result = calc.add(10).multiply(3).getResult();
            
            output.innerHTML = `
                <div class="output">
                    <h4>ëª¨ë“ˆ ì‹œë®¬ë ˆì´ì…˜ ê²°ê³¼</h4>
                    <p><strong>mathUtils.add(5, 3):</strong> ${mathUtils.add(5, 3)}</p>
                    <p><strong>mathUtils.PI:</strong> ${mathUtils.PI}</p>
                    <p><strong>Calculator ì²´ì´ë‹:</strong> (0 + 10) Ã— 3 = ${result}</p>
                    <p><strong>API ëª¨ë“ˆ:</strong> getUser, createPost í•¨ìˆ˜ ì‚¬ìš© ê°€ëŠ¥</p>
                    
                    <h5>ì‹¤ì œ ëª¨ë“ˆ ì‚¬ìš©ë²•:</h5>
                    <pre style="background: #f0f0f0; padding: 10px; border-radius: 4px;">
// math.js
export const add = (a, b) => a + b;
export class Calculator { ... }

// main.js
import { add, Calculator } from './math.js';
const calc = new Calculator();
                    </pre>
                </div>
            `;
        }
        
        // ì‹¤ì œ íŒ¨í„´ ì‹œì—°
        async function demonstrateApiClient() {
            const output = document.getElementById('pattern-output');
            output.innerHTML = '<div class="loading"></div> API í´ë¼ì´ì–¸íŠ¸ í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            // API í´ë¼ì´ì–¸íŠ¸ ì‹œë®¬ë ˆì´ì…˜
            class ApiClient {
                constructor(baseURL) {
                    this.baseURL = baseURL;
                }
                
                async get(endpoint) {
                    const response = await fetch(`${this.baseURL}${endpoint}`);
                    return response.json();
                }
                
                async post(endpoint, data) {
                    const response = await fetch(`${this.baseURL}${endpoint}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                    return response.json();
                }
            }
            
            try {
                const api = new ApiClient('https://jsonplaceholder.typicode.com');
                
                const user = await api.get('/users/1');
                const newPost = await api.post('/posts', {
                    title: 'Test Post',
                    body: 'This is a test post',
                    userId: 1
                });
                
                output.innerHTML = `
                    <div class="output">
                        <h4>API í´ë¼ì´ì–¸íŠ¸ ê²°ê³¼</h4>
                        <p><strong>GET ìš”ì²­:</strong> ${user.name} (${user.email})</p>
                        <p><strong>POST ìš”ì²­:</strong> ê²Œì‹œê¸€ ID ${newPost.id} ìƒì„±ë¨</p>
                        <p><strong>ì œëª©:</strong> ${newPost.title}</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="error">
                        <h4>API í´ë¼ì´ì–¸íŠ¸ ì—ëŸ¬</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function demonstrateBatchProcessing() {
            const output = document.getElementById('pattern-output');
            output.innerHTML = '<div class="loading"></div> ë°°ì¹˜ ì²˜ë¦¬ ì¤‘...';
            
            const items = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H'];
            const batchSize = 3;
            const delay = 1000;
            
            let processedCount = 0;
            const startTime = Date.now();
            
            try {
                for (let i = 0; i < items.length; i += batchSize) {
                    const batch = items.slice(i, i + batchSize);
                    
                    output.innerHTML = `
                        <div class="loading"></div>
                        <p>ë°°ì¹˜ ${Math.floor(i / batchSize) + 1} ì²˜ë¦¬ ì¤‘...</p>
                        <p>í•­ëª©: [${batch.join(', ')}]</p>
                        <p>ì²˜ë¦¬ëœ í•­ëª©: ${processedCount}/${items.length}</p>
                    `;
                    
                    // ë°°ì¹˜ ì²˜ë¦¬ ì‹œë®¬ë ˆì´ì…˜
                    await Promise.all(batch.map(async (item) => {
                        await new Promise(resolve => setTimeout(resolve, 500));
                        return `ì²˜ë¦¬ë¨: ${item}`;
                    }));
                    
                    processedCount += batch.length;
                    
                    if (i + batchSize < items.length) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
                
                const endTime = Date.now();
                
                output.innerHTML = `
                    <div class="output">
                        <h4>ë°°ì¹˜ ì²˜ë¦¬ ì™„ë£Œ</h4>
                        <p><strong>ì´ í•­ëª©:</strong> ${items.length}ê°œ</p>
                        <p><strong>ë°°ì¹˜ í¬ê¸°:</strong> ${batchSize}ê°œ</p>
                        <p><strong>ì´ ì²˜ë¦¬ ì‹œê°„:</strong> ${endTime - startTime}ms</p>
                        <p><strong>ì²˜ë¦¬ëœ í•­ëª©:</strong> ${items.join(', ')}</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="error">
                        <h4>ë°°ì¹˜ ì²˜ë¦¬ ì—ëŸ¬</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function demonstrateCachedFetch() {
            const output = document.getElementById('pattern-output');
            output.innerHTML = '<div class="loading"></div> ìºì‹œëœ fetch í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            const cache = new Map();
            
            async function cachedFetch(url, cacheTime = 5000) {
                const now = Date.now();
                const cached = cache.get(url);
                
                if (cached && (now - cached.timestamp) < cacheTime) {
                    return { ...cached.data, fromCache: true };
                }
                
                const response = await fetch(url);
                const data = await response.json();
                
                cache.set(url, {
                    data,
                    timestamp: now,
                });
                
                return { ...data, fromCache: false };
            }
            
            try {
                const url = 'https://jsonplaceholder.typicode.com/users/1';
                
                // ì²« ë²ˆì§¸ ìš”ì²­
                const first = await cachedFetch(url);
                await new Promise(resolve => setTimeout(resolve, 100));
                
                // ë‘ ë²ˆì§¸ ìš”ì²­ (ìºì‹œì—ì„œ)
                const second = await cachedFetch(url);
                
                output.innerHTML = `
                    <div class="output">
                        <h4>ìºì‹œëœ Fetch ê²°ê³¼</h4>
                        <p><strong>ì²« ë²ˆì§¸ ìš”ì²­:</strong> ${first.name} (ìºì‹œ: ${first.fromCache ? 'Yes' : 'No'})</p>
                        <p><strong>ë‘ ë²ˆì§¸ ìš”ì²­:</strong> ${second.name} (ìºì‹œ: ${second.fromCache ? 'Yes' : 'No'})</p>
                        <p><strong>ìºì‹œ í¬ê¸°:</strong> ${cache.size}ê°œ í•­ëª©</p>
                        <p>ë‘ ë²ˆì§¸ ìš”ì²­ì€ ìºì‹œì—ì„œ ê°€ì ¸ì™€ ë” ë¹ ë¦…ë‹ˆë‹¤!</p>
                    </div>
                `;
            } catch (error) {
                output.innerHTML = `
                    <div class="error">
                        <h4>ìºì‹œëœ Fetch ì—ëŸ¬</h4>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>